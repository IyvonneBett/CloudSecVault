---
author_name: Nick Frichette
title: Bypass GuardDuty Pentest Findings
description: Prevent Kali Linux, ParrotOS, and Pentoo Linux from throwing GuardDuty alerts by modifying the User Agent string.
hide:
  - toc
---

# Bypass GuardDuty Pentest Findings

When making AWS API requests on common penetration testing OS's GuardDuty will detect this and trigger a [PenTest Finding](https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_finding-types-iam.html#pentest-iam-kalilinux).

This is caused by the user agent name that is passed in the API request. By modifying that we can prevent GuardDuty from detecting that we are operating from a "pentest" Linux distribution.

!!! Warning
    If your assessment requires you to remain undetected it's probably easier to leverage a "safe" OS like Ubuntu, Mac OS, or Windows.

To do this, identify the location of your ```session.py``` in the ```botocore``` package. For example, on a default Kali Linux install it can be found at ```/usr/local/lib/python3.7/dist-packages/botocore/session.py```.

On line [456](https://github.com/boto/botocore/blob/7de36c07ecec503f588ac27658b1795e83b67b75/botocore/session.py#L456) (at the time of writing), you should see the following.

<figure markdown>
  ![lines](/images/aws/avoiding-detection/guardduty-pentest/lines.jpg){ loading=lazy }
</figure>

```platform.system()``` and ```platform.release()``` are similar to ```uname -o``` and ```uname -r```. On a stock Kali install it will generate the following values.

<figure markdown>
  ![example](/images/aws/avoiding-detection/guardduty-pentest/example.png){ loading=lazy }
</figure>

To get around this, modify the code and replace it with legitimate user agent strings like those found in [Pacu](https://github.com/RhinoSecurityLabs/pacu/blob/master/pacu/user_agents.txt). With this capability you can mask your user agent to look like anything you want. Even arbitrary values like below.

<figure markdown>
  ![modified](/images/aws/avoiding-detection/guardduty-pentest/modified.jpg){ loading=lazy }
</figure>
